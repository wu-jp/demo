<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>

<body>
  <script>
    // // one
    // const promise = new Promise(function(resolve, reject) {
    //   // some code 
    //   if(/* 异步操作成功 */true){
    //     resolve(value)
    //   }else{
    //     reject(error)
    //   }
    // })


    // // two
    // function timeout(ms) {
    //   return new Promise((resolve, reject) => {
    //     setTimeout(resolve, ms, 'done')
    //   })
    // }
    // timeout(1000).then((value) => {
    //   console.log(value)
    // })


    // //three
    // let promise = new Promise(function(resolve, reject) {
    //   console.log("promise")
    //   resolve();
    // })
    // promise.then(function() {
    //   console.log('resolve')
    // })
    // console.log('Hi')
    // // promise
    // // Hi
    // // resolve


    // // four 异步加载图片的例子
    // function loadImageAsync(url) {
    //   return new Promise(function(resolve, reject) {
    //     const image = new Image();
    //     image.onload = function() {
    //       resolve(image)
    //     };
    //     image.onerror = function() {
    //       reject(new Error('Could not load image at' + url))
    //     };
    //     image.src = url
    //   })
    // }


    // // five 实现的 Ajax 操作的例子
    // const getJSON = function (url) {
    //   const promise = new Promise(function (resolve, reject) {
    //     const handler = function () {
    //       if (this.readState !== 4) {
    //         return
    //       }
    //       if (this.status === 200) {
    //         resolve(this.response)
    //       } else {
    //         reject(new Error(this.statusText))
    //       }
    //     };
    //     const client = new XMLHttpRequest();
    //     client.open('GET', url);
    //     client.onreadystatechange = healer;
    //     client.responseType = 'json';
    //     client.setRequestHeader('Accept', 'application/json');
    //     client.send();
    //   });
    //   return promise
    // }
    // getJSON('/posts.json').then(function (json) {
    //   console.log('Contents:' + json);
    // }, function (error) {
    //   console.error('出错了', error)
    // })


    // // six 链式调用.then()方法
    // getJSON("/post/1.json").then(
    //   post => getJSON(post.commentURL)
    // ).then(
    //   comments => console.log("resolved: ", comments),
    //   err => console.log("rejected: ", err)
    // );
    // // 上面代码中，第一个then方法指定的回调函数，返回的是另一个Promise对象。
    // // 这时，第二个then方法指定的回调函数，就会等待这个新的Promise对象状态发生变化。
    // // 如果变为resolved，就调用第一个回调函数，如果状态变为rejected，就调用第二个回调函数。


    // // seven .catch()方法
    // getJSON('/posts.json').then(function(posts) {
    //   // ...
    // }).catch(function(error) {
    //   // 处理 getJSON 和 前一个回调函数运行时发生的错误
    //   console.log('发生错误！', error);
    // });
    // // 上面代码中，getJSON方法返回一个 Promise 对象，如果该对象状态变为resolved，则会调用then方法指定的回调函数；
    // // 如果异步操作抛出错误，状态就会变为rejected，就会调用catch方法指定的回调函数，处理这个错误。
    // // 另外，then方法指定的回调函数，如果运行中抛出错误，也会被catch方法捕获。


    // eight .finally()方法



  </script>
</body>

</html>